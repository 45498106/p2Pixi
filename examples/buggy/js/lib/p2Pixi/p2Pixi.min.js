/** 
 * p2Pixi v0.81 - 11-11-2015 
 * Copyright (c) Tom W Hall <tomshalls@gmail.com> 
 * A simple 2D vector game model framework using p2.js for physics and Pixi.js for rendering. 
 * License: MIT 
 */
var P2Pixi;!function(a){"use strict";var b=function(){function b(b){b=b||{},b.trackedBodyOffset=b.trackedBodyOffset||[0,0],this.options=b,this.world=new p2.World(b.worldOptions||{}),this.pixiAdapter=new a.PixiAdapter(b.pixiOptions||{}),this.gameObjects=[],this.trackedBody=null,this.paused=!1,this.lastWorldStepTime=null,this.assetsLoaded=!1,b.assetUrls?this.loadAssets(b.assetUrls):this.assetsLoaded=!0,this.runIfAssetsLoaded()}return b.prototype.addGameObject=function(a){this.gameObjects.push(a)},b.prototype.removeGameObject=function(a){var b=this.gameObjects.indexOf(a);-1!==b&&(a.clear(),this.gameObjects.splice(b,1))},b.prototype.loadAssets=function(a){var b,c=this,d=PIXI.loader;for(b=0;b<a.length;b++)d.add(a[b],a[b]);d.once("complete",function(){c.assetsLoaded=!0,c.runIfAssetsLoaded()}),d.load()},b.prototype.beforeRun=function(){},b.prototype.runIfAssetsLoaded=function(){this.assetsLoaded&&(this.beforeRun(),this.run())},b.prototype.time=function(){return(new Date).getTime()/1e3},b.prototype.run=function(){function a(){var d;b.paused||(d=b.time()-b.lastWorldStepTime,b.lastWorldStepTime=b.time(),b.world.step(1/60,d,c)),b.beforeRender(),b.render(),b.afterRender(),requestAnimationFrame(a)}var b=this,c=10;b.lastWorldStepTime=b.time(),requestAnimationFrame(a)},b.prototype.beforeRender=function(){var a,b,c,d,e,f,g,h=this.trackedBody;null!==h&&(a=this.pixiAdapter,b=a.renderer,c=a.pixelsPerLengthUnit,d=a.container.position,e=h.position,f=this.options.trackedBodyOffset,g=a.deviceScale,d.x=(f[0]+1)*b.width*.5-e[0]*c*g,d.y=(f[1]+1)*b.height*.5+e[1]*c*g)},b.prototype.render=function(){var a,b,c,d,e,f,g=this.pixiAdapter,h=g.pixelsPerLengthUnit,i=this.gameObjects,j=i.length;for(c=0;j>c;c++)for(a=i[c],b=a.bodies.length,d=0;b>d;d++)e=a.bodies[d],f=a.containers[d],f.position.x=e.position[0]*h,f.position.y=-e.position[1]*h,f.rotation=-e.angle;g.renderer.render(g.stage)},b.prototype.afterRender=function(){},b.prototype.clear=function(){for(;this.gameObjects.length>0;)this.removeGameObject(this.gameObjects[0])},b.prototype.pauseToggle=function(){this.paused=!this.paused,this.paused||(this.lastWorldStepTime=this.time())},b}();a.Game=b}(P2Pixi||(P2Pixi={}));var P2Pixi;!function(a){"use strict";var b=function(){function a(a){this.game=a,this.bodies=[],this.constraints=[],this.containers=[],a.addGameObject(this)}return a.prototype.addBody=function(a){var b=new PIXI.Container;return this.bodies.push(a),this.game.world.addBody(a),this.containers.push(b),this.game.pixiAdapter.container.addChild(b),this},a.prototype.addShape=function(a,b,c,d,e,f,g,h,i){var j;return c=c||[0,0],d=d||0,e=e||{},b.collisionGroup=e.collisionGroup||1,b.collisionMask=e.collisionMask||1,a.addShape(b,c,d),j=this.containers[this.bodies.indexOf(a)],this.game.pixiAdapter.addShape(j,b,c,d,f,g,h,i),this},a.prototype.addConstraint=function(a){return this.constraints.push(a),this.game.world.addConstraint(a),this},a.prototype.clear=function(){var a,b=this.game,c=b.world,d=b.pixiAdapter.container;for(a=0;a<this.constraints.length;a++)c.removeConstraint(this.constraints[a]);for(a=0;a<this.bodies.length;a++)c.removeBody(this.bodies[a]),d.removeChild(this.containers[a])},a}();a.GameObject=b}(P2Pixi||(P2Pixi={}));var P2Pixi;!function(a){"use strict";var b=function(){function a(a){var b,c={pixelsPerLengthUnit:128,width:1280,height:720,transparent:!1,antialias:!0,useDeviceAspect:!1,webGLEnabled:!0,useDevicePixels:!0};a=a||{};for(b in a)c[b]=a[b];c.useDeviceAspect&&(c.height=window.innerHeight/window.innerWidth*c.width),this.settings=c,this.pixelsPerLengthUnit=c.pixelsPerLengthUnit,k.call(this),this.stage=new PIXI.Container,this.container=new PIXI.Container,this.stage.addChild(this.container),this.setDeviceProperties(),this.setupRenderer(),this.setupView()}var b=p2.vec2,c=(p2.Body,p2.Circle),d=p2.Capsule,e=p2.Convex,f=p2.Plane,g=p2.Box,h=p2.Particle,i=p2.Line,j=p2.Heightfield,k=p2.EventEmitter;return a.prototype=new k,a.prototype.setDeviceProperties=function(){var a=this.settings;this.devicePixelRatio=a.useDevicePixels?window.devicePixelRatio||1:1,this.deviceScale=1!==this.devicePixelRatio?Math.round(Math.max(screen.width,screen.height)*this.devicePixelRatio)/Math.max(a.width,a.height):1},a.prototype.setupRenderer=function(){var a=this.settings,b=this.deviceScale;this.renderer=a.webGLEnabled?PIXI.autoDetectRenderer(a.width*b,a.height*b,a):new PIXI.CanvasRenderer(a.width*b,a.height*b,a)},a.prototype.setupView=function(){function a(){b.resize(window.innerWidth,window.innerHeight)}var b=this,c=this.renderer,d=this.renderer.view,e=this.container,f=this.deviceScale;d.style.position="absolute",document.body.appendChild(this.renderer.view),this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,e.position.x=c.width/2,e.position.y=c.height/2,e.scale.x=f,e.scale.y=f,this.viewCssWidth=0,this.viewCssHeight=0,this.resize(this.windowWidth,this.windowHeight),window.addEventListener("resize",a),window.addEventListener("orientationchange",a)},a.prototype.drawCircle=function(a,b,c,d,e){e=e||{};var f=e.lineWidthUnits?e.lineWidthUnits*this.pixelsPerLengthUnit:e.lineWidth||0,g=e.lineColor||0,h=e.fillColor;a.lineStyle(f,g,1),h&&a.beginFill(h,1),a.drawCircle(b,c,d),h&&a.endFill()},a.prototype.drawPlane=function(a,b,c,d,e){e=e||{};var f=1e6,g=e.lineWidthUnits?e.lineWidthUnits*this.pixelsPerLengthUnit:e.lineWidth||0,h=e.lineColor||0,i=e.fillColor;a.lineStyle(g,h,1),i&&a.beginFill(i,1),a.moveTo(-f,0),a.lineTo(f,0),a.lineTo(f,f),a.lineTo(-f,f),i&&a.endFill(),a.lineStyle(g,h),a.moveTo(-f,0),a.lineTo(f,0)},a.prototype.drawLine=function(a,b,c){c=c||{};var d=c.lineWidthUnits?c.lineWidthUnits*this.pixelsPerLengthUnit:c.lineWidth||1,e=c.lineColor||0;a.lineStyle(d,e,1),a.moveTo(-b/2,0),a.lineTo(b/2,0)},a.prototype.drawCapsule=function(a,b,c,d,e,f,g){g=g||{};var h=Math.cos(d),i=Math.sin(d),j=g.lineWidthUnits?g.lineWidthUnits*this.pixelsPerLengthUnit:g.lineWidth||0,k=g.lineColor||0,l=g.fillColor;a.lineStyle(j,k,1),l&&a.beginFill(l,1),a.drawCircle(-e/2*h+b,-e/2*i+c,f),a.drawCircle(e/2*h+b,e/2*i+c,f),l&&a.endFill(),a.lineStyle(j,k,0),l&&a.beginFill(l,1),a.moveTo(-e/2*h+f*i+b,-e/2*i+f*h+c),a.lineTo(e/2*h+f*i+b,e/2*i+f*h+c),a.lineTo(e/2*h-f*i+b,e/2*i-f*h+c),a.lineTo(-e/2*h-f*i+b,-e/2*i-f*h+c),l&&a.endFill(),a.lineStyle(j,k,1),a.moveTo(-e/2*h+f*i+b,-e/2*i+f*h+c),a.lineTo(e/2*h+f*i+b,e/2*i+f*h+c),a.moveTo(-e/2*h-f*i+b,-e/2*i-f*h+c),a.lineTo(e/2*h-f*i+b,e/2*i-f*h+c)},a.prototype.drawRectangle=function(a,b,c,d,e,f){f=f||{};var g=f.lineWidthUnits?f.lineWidthUnits*this.pixelsPerLengthUnit:f.lineWidth||0,h=f.lineColor||0,i=f.fillColor;a.lineStyle(g,h,1),i&&a.beginFill(i,1),a.drawRect(b-d/2,c-e/2,d,e),i&&a.endFill()},a.prototype.drawConvex=function(a,b,c){c=c||{};var d=c.lineWidthUnits?c.lineWidthUnits*this.pixelsPerLengthUnit:c.lineWidth||0,e=c.lineColor||0,f=c.fillColor;a.lineStyle(d,e,1),f&&a.beginFill(f,1);for(var g=0;g!==b.length;g++){var h=b[g],i=h[0],j=h[1];0==g?a.moveTo(i,j):a.lineTo(i,j)}f&&a.endFill(),b.length>2&&0!==d&&(a.moveTo(b[b.length-1][0],b[b.length-1][1]),a.lineTo(b[0][0],b[0][1]))},a.prototype.drawPath=function(a,b,c){c=c||{};var d=c.lineWidthUnits?c.lineWidthUnits*this.pixelsPerLengthUnit:c.lineWidth||0,e=c.lineColor||0,f=c.fillColor;a.lineStyle(d,e,1),f&&a.beginFill(f,1);for(var g=null,h=null,i=0;i<b.length;i++){var j=b[i],k=j[0],l=j[1];if(k!=g||l!=h){if(0==i)a.moveTo(k,l);else{var m=g,n=h,o=k,p=l,q=b[(i+1)%b.length][0],r=b[(i+1)%b.length][1],s=(o-m)*(r-n)-(q-m)*(p-n);0!=s&&a.lineTo(k,l)}g=k,h=l}}f&&a.endFill(),b.length>2&&c.fillColor&&(a.moveTo(b[b.length-1][0],b[b.length-1][1]),a.lineTo(b[0][0],b[0][1]))},a.prototype.renderShapeToGraphics=function(a,k,l,m,n){var o,p,q,r,s,t,u=[0,0],v=this.pixelsPerLengthUnit;if(l=l||u,m=m||0,k instanceof c)this.drawCircle(a,l[0]*v,-l[1]*v,k.radius*v,n);else if(k instanceof h)this.drawCircle(a,l[0]*v,-l[1]*v,2*lw,n);else if(k instanceof f)this.drawPlane(a,-10*v,10*v,n);else if(k instanceof i)this.drawLine(a,k.length*v,n);else if(k instanceof g)this.drawRectangle(a,l[0]*v,-l[1]*v,k.width*v,k.height*v,n);else if(k instanceof d)this.drawCapsule(a,l[0]*v,-l[1]*v,m,k.length*v,k.radius*v,n);else if(k instanceof e){for(o=[],p=b.create(),s=0;s<k.vertices.length;s++)t=k.vertices[s],b.rotate(p,t,m),o.push([(p[0]+l[0])*v,-(p[1]+l[1])*v]);this.drawConvex(a,o,n)}else if(k instanceof j){for(q=[[0,100*v]],r=k.heights,s=0;s<r.length;s++)t=r[s],q.push([s*k.elementWidth*v,-t*v]);q.push([r.length*k.elementWidth*v,100*v]),this.drawPath(a,q,n)}},a.prototype.addShape=function(a,b,c,d,e,f,h,i){var k,l,m,n,o,p,q,r,s,t,u,v=[0,0],w=this.pixelsPerLengthUnit,i=i||{};f&&(n=new p2.AABB,b.computeAABB(n,v,0),q=n.lowerBound[0],t=n.lowerBound[1],s=n.upperBound[0],r=n.upperBound[1],b instanceof j&&(t=-(this.settings.height/w)),o=s-q,p=r-t,l=i.tile===!1?new PIXI.Sprite(f):new PIXI.extras.TilingSprite(f,o*w,p*w),l.alpha=h||1,b instanceof g||(u=new PIXI.Graphics,u.renderable=!1,u.position.x=c[0]*w,u.position.y=-(c[1]*w),u.rotation=-d,this.renderShapeToGraphics(u,b,v,0,{lineWidth:0,fillColor:16777215}),a.addChild(u),l.mask=u),0===d?(l.position.x=q*w+c[0]*w,l.position.y=-(r*w)-c[1]*w,l.rotation=-d,a.addChild(l)):(l.position.x=q*w,l.position.y=-(r*w),m=new PIXI.Container,m.addChild(l),m.position.x=c[0]*w,m.position.y=-(c[1]*w),m.rotation=-d,m.addChild(l),a.addChild(m))),e&&(k=new PIXI.Graphics,k.alpha=h||1,k.position.x=c[0]*w,k.position.y=-(c[1]*w),k.rotation=-d,this.renderShapeToGraphics(k,b,v,0,e),a.addChild(k))},a.prototype.resize=function(a,b){var c=this.renderer,d=c.view,e=a/b,f=c.width/c.height;this.windowWidth=a,this.windowHeight=b,e>f?(this.viewCssWidth=b*f,this.viewCssHeight=b,d.style.width=this.viewCssWidth+"px",d.style.height=this.viewCssHeight+"px",d.style.left=Math.round((a-this.viewCssWidth)/2)+"px",d.style.top=null):(this.viewCssWidth=a,this.viewCssHeight=Math.round(a/f),d.style.width=this.viewCssWidth+"px",d.style.height=this.viewCssHeight+"px",d.style.left=null,d.style.top=Math.round((b-this.viewCssHeight)/2)+"px")},a}();a.PixiAdapter=b}(P2Pixi||(P2Pixi={}));