/** 
 * p2Pixi v0.5.4 - 29-04-2014 
 * Copyright (c) Tom W Hall <tomshalls@gmail.com> 
 * A simple 2D vector game model framework using p2.js for physics and Pixi.js for rendering. 
 * License: MIT 
 */
var P2Pixi;!function(a){"use strict";var b=function(){function b(b){b=b||{},this.world=new p2.World(b.worldOptions||{}),this.pixiAdapter=new a.PixiAdapter(b.pixiOptions||{}),this.gameObjects=[],this.trackedBody=null,this.trackedBodyOffset=[.5,.5],this.paused=!1,b.imageUrls?this.loadImages(b.imageUrls):this.assetsLoaded()}return b.prototype.addGameObject=function(a){this.gameObjects.push(a)},b.prototype.removeGameObject=function(a){var b,c,d,e=this.gameObjects.indexOf(a);if(-1!==e){for(b=0;b<a.bodies.length;b++)c=a.bodies[b],d=a.displayObjectContainers[b],this.world.removeBody(c),this.pixiAdapter.stage.removeChild(d);this.gameObjects.splice(e,1)}},b.prototype.loadImages=function(a){var b,c,d=this,e=a.length,f=0;for(b=0;e>b;b++)c=new PIXI.ImageLoader(a[b],!1),c.addEventListener("loaded",function(){f++,f===e&&d.assetsLoaded()}),c.load()},b.prototype.beforeRun=function(){},b.prototype.assetsLoaded=function(){this.beforeRun(),this.run()},b.prototype.time=function(){return(new Date).getTime()/1e3},b.prototype.run=function(){function a(){var e;b.paused||(e=b.time()-c,c=b.time(),b.world.step(1/60,e,d)),b.render(),requestAnimationFrame(a)}var b=this,c=b.time(),d=10;requestAnimationFrame(a)},b.prototype.render=function(){var a,b,c,d,e,f,g,h=this.pixiAdapter,i=(h.renderer.width,h.renderer.height),j=h.pixelsPerLengthUnit,k=this.gameObjects,l=k.length,m=this.trackedBody,n=this.trackedBodyOffset;for(c=0;l>c;c++)for(a=k[c],b=a.bodies.length,d=0;b>d;d++)e=a.bodies[d],f=a.displayObjectContainers[d],f.position.x=e.position[0]*j,f.position.y=i-e.position[1]*j,f.rotation=-e.angle;null!==m&&(g=m.position,h.stage.position.x=h.renderer.width*n[0]-g[0]*j,h.stage.position.y=-(h.renderer.height*(1-n[1]))+g[1]*j),h.renderer.render(h.container)},b}();a.Game=b}(P2Pixi||(P2Pixi={}));var P2Pixi;!function(a){"use strict";var b=function(){function a(a){this.game=a,this.bodies=[],this.displayObjectContainers=[],a.addGameObject(this)}return a.prototype.addBody=function(a){return this.bodies.push(a),this.displayObjectContainers.push(null),this.game.world.addBody(a),this},a.prototype.addShape=function(a,b,c,d,e,f,g,h){var i;return c=c||[0,0],d=d||0,e=e||{},b.collisionGroup=e.collisionGroup||1,b.collisionMask=e.collisionMask||1,a.addShape(b,c,d),i=this.displayObjectContainers[this.bodies.indexOf(a)],null===i&&(i=new PIXI.DisplayObjectContainer,this.displayObjectContainers[this.bodies.indexOf(a)]=i,this.game.pixiAdapter.stage.addChild(i)),this.game.pixiAdapter.addShape(i,b,c,d,f,g,h),this},a.prototype.time=function(){return(new Date).getTime()/1e3},a}();a.GameObject=b}(P2Pixi||(P2Pixi={}));var P2Pixi;!function(a){"use strict";var b=function(){function a(a){function b(){return window.innerWidth||document.documentElement.clientWidth}function c(){return window.innerHeight||document.documentElement.clientHeight}function d(){f.resize(b(),c())}var e,f=this;a=a||{};var g={pixelsPerLengthUnit:128,width:1280,height:720,useDeviceAspect:!0};for(e in a)g[e]=a[e];g.useDeviceAspect&&(g.height=c()/b()*g.width),this.settings=g;this.pixelsPerLengthUnit=g.pixelsPerLengthUnit;j.call(this),this.renderer=PIXI.autoDetectRenderer(this.settings.width,this.settings.height,this.settings.viewport,this.settings.transparent,!0),this.stage=new PIXI.DisplayObjectContainer,this.container=new PIXI.Stage(16777215,!0),this.container.addChild(this.stage),this.renderer.view.style.position="absolute",document.body.appendChild(this.renderer.view),this.stage.position.x=this.renderer.width/2,this.stage.position.y=-this.renderer.height/2,this.windowWidth=b(),this.windowHeight=c(),this.resize(this.windowWidth,this.windowHeight),window.addEventListener("resize",d),window.addEventListener("orientationchange",d)}{var b=p2.vec2,c=(p2.Body,p2.Circle),d=p2.Capsule,e=p2.Convex,f=p2.Plane,g=p2.Rectangle,h=p2.Particle,i=p2.Line,j=p2.EventEmitter;b.create(),b.create()}return a.prototype=new j,a.prototype.drawCircle=function(a,b,c,d,e){e=e||{};var f=e.lineWidth||0,g=e.lineColor||0,h=e.fillColor;a.lineStyle(f,g,1),h&&a.beginFill(h,1),a.drawCircle(b,c,d),h&&a.endFill()},a.prototype.drawPlane=function(a,b,c,d,e){e=e||{};var f=1e6,g=e.lineWidth||0,h=e.lineColor||0,i=e.fillColor;a.lineStyle(g,h,1),i&&a.beginFill(i,1),a.moveTo(-f,0),a.lineTo(f,0),a.lineTo(f,f),a.lineTo(-f,f),i&&a.endFill(),a.lineStyle(g,h),a.moveTo(-f,0),a.lineTo(f,0)},a.prototype.drawLine=function(a,b,c){c=c||{};var d=c.lineWidth||1,e=c.lineColor||0;a.lineStyle(d,e,opacity),a.moveTo(-b/2,0),a.lineTo(b/2,0)},a.prototype.drawCapsule=function(a,b,c,d,e,f,g){g=g||{};var h=Math.cos(d),i=Math.sin(d),j=g.lineWidth||0,k=g.lineColor||0,l=g.fillColor;a.lineStyle(j,k,1),l&&a.beginFill(l,1),a.drawCircle(-e/2*h+b,-e/2*i+c,f),a.drawCircle(e/2*h+b,e/2*i+c,f),l&&a.endFill(),a.lineStyle(j,k,0),l&&a.beginFill(l,1),a.moveTo(-e/2*h+f*i+b,-e/2*i+f*h+c),a.lineTo(e/2*h+f*i+b,e/2*i+f*h+c),a.lineTo(e/2*h-f*i+b,e/2*i-f*h+c),a.lineTo(-e/2*h-f*i+b,-e/2*i-f*h+c),l&&a.endFill(),a.lineStyle(j,k,1),a.moveTo(-e/2*h+f*i+b,-e/2*i+f*h+c),a.lineTo(e/2*h+f*i+b,e/2*i+f*h+c),a.moveTo(-e/2*h-f*i+b,-e/2*i-f*h+c),a.lineTo(e/2*h-f*i+b,e/2*i-f*h+c)},a.prototype.drawRectangle=function(a,b,c,d,e,f){f=f||{};var g=f.lineWidth||0,h=f.lineColor||0,i=f.fillColor;a.lineStyle(g,h,1),i&&a.beginFill(i,1),a.drawRect(b-d/2,c-e/2,d,e),i&&a.endFill()},a.prototype.drawConvex=function(a,b,c){c=c||{};var d=c.lineWidth||0,e=c.lineColor||0,f=c.fillColor;a.lineStyle(d,e,1),f&&a.beginFill(f,1);for(var g=0;g!==b.length;g++){var h=b[g],i=h[0],j=h[1];0==g?a.moveTo(i,j):a.lineTo(i,j)}f&&a.endFill(),b.length>2&&(a.moveTo(b[b.length-1][0],b[b.length-1][1]),a.lineTo(b[0][0],b[0][1]))},a.prototype.drawPath=function(a,b,c){c=c||{};var d=c.lineWidth||0,e=c.lineColor||0,f=c.fillColor;a.lineStyle(d,e,1),f&&a.beginFill(f,1);for(var g=null,h=null,i=0;i<b.length;i++){var j=b[i],k=j[0],l=j[1];if(k!=g||l!=h){if(0==i)a.moveTo(k,l);else{var m=g,n=h,o=k,p=l,q=b[(i+1)%b.length][0],r=b[(i+1)%b.length][1],s=(o-m)*(r-n)-(q-m)*(p-n);0!=s&&a.lineTo(k,l)}g=k,h=l}}f&&a.endFill(),b.length>2&&c.fillColor&&(a.moveTo(b[b.length-1][0],b[b.length-1][1]),a.lineTo(b[0][0],b[0][1]))},a.prototype.renderShapeToGraphics=function(a,j,k,l,m){var n,o,p,q,r=[0,0],s=this.pixelsPerLengthUnit;if(k=k||r,l=l||0,j instanceof c)this.drawCircle(a,k[0]*s,-k[1]*s,j.radius*s,m);else if(j instanceof h)this.drawCircle(a,k[0]*s,-k[1]*s,2*lw,m);else if(j instanceof f)this.drawPlane(a,-10*s,10*s,m);else if(j instanceof i)this.drawLine(a,child.length*s,m);else if(j instanceof g)this.drawRectangle(a,k[0]*s,-k[1]*s,j.width*s,j.height*s,m);else if(j instanceof d)this.drawCapsule(a,k[0]*s,-k[1]*s,l,j.length*s,j.radius*s,m);else if(j instanceof e){for(n=[],o=b.create(),p=0;p<j.vertices.length;p++)q=j.vertices[p],b.rotate(o,q,l),n.push([(o[0]+k[0])*s,-(o[1]+k[1])*s]);this.drawConvex(a,n,m)}},a.prototype.addShape=function(a,b,c,d,e,f,h){var i,j,k,l,m,n,o,p,q,r,s,t=[0,0],u=this.pixelsPerLengthUnit;f&&(l=new p2.AABB,b.computeAABB(l,t,0),o=l.lowerBound[0],r=l.lowerBound[1],q=l.upperBound[0],p=l.upperBound[1],m=q-o,n=p-r,j=new PIXI.TilingSprite(f,m*u,n*u),j.alpha=h||1,b instanceof g||(s=new PIXI.Graphics,s.renderable=!1,s.position.x=c[0]*u,s.position.y=-(c[1]*u),s.rotation=-d,this.renderShapeToGraphics(s,b,t,0,{lineWidth:0,fillColor:16777215}),a.addChild(s),j.mask=s),0===d?(j.position.x=o*u+c[0]*u,j.position.y=-(p*u)-c[1]*u,j.rotation=-d,a.addChild(j)):(j.position.x=o*u,j.position.y=-(p*u),k=new PIXI.DisplayObjectContainer,k.addChild(j),k.position.x=c[0]*u,k.position.y=-(c[1]*u),k.rotation=-d,k.addChild(j),a.addChild(k))),e&&(i=new PIXI.Graphics,i.alpha=h||1,i.position.x=c[0]*u,i.position.y=-(c[1]*u),i.rotation=-d,this.renderShapeToGraphics(i,b,t,0,e),a.addChild(i))},a.prototype.resize=function(a,b){this.windowWidth=a,this.windowHeight=b;var c=this.renderer,d=c.view,e=a/b,f=c.width/c.height;e>f?(d.style.height=b+"px",d.style.width=b*f+"px",d.style.left=(a-b*f)/2+"px"):(d.style.height=a/f+"px",d.style.width=a+"px",d.style.top=(b-a/f)/2+"px")},a}();a.PixiAdapter=b}(P2Pixi||(P2Pixi={}));